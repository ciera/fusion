<html><body><link rel="stylesheet" type="text/css" href="style.css"/><div id="posts"><!-- post #83956 -->
<!-- open content container -->
<div align="center">
<div class="page" style="width:100%; text-align:left">
<div style="padding:0px 0px 0px 0px" align="left">
<div id="edit83956" style="padding:0px 0px 6px 0px">
<!-- this is not the last post shown on the page -->
<table class="tborder" id="post83956" cellpadding="6" cellspacing="1" border="0" width="100%" align="center">
<tr>
<td class="thead">
<div class="normal" style="float:right">
			&nbsp;
			#<a href="showpost.php?p=83956&amp;postcount=1" target="new" rel="nofollow" id="postcount83956" name="1"><strong>1</strong></a> &nbsp;
			
			
			<a href="report.php?p=83956" rel="nofollow"><img class="inlineimg" src="images/buttons/report.gif" alt="Report Post" border="0" /></a> &nbsp;
			
			
		</div>
<div class="normal">
<!-- status icon and date -->
<a name="post83956"><img class="inlineimg" src="images/statusicon/post_old.gif" alt="Old" border="0" /></a>
			
				Nov 1st, 2006, 10:26 AM
			
			
			<!-- / status icon and date -->
</div>
</td>
</tr>
<tr>
<td class="alt2" style="padding:0px">
<!-- user info -->
<table cellpadding="0" cellspacing="6" border="0" width="100%">
<tr>
<td nowrap="nowrap">
<div id="postmenu_83956">
<a class="bigusername" href="member.php?u=20416">ahardy66</a>
<img class="inlineimg" src="images/statusicon/user_offline.gif" alt="ahardy66 is offline" border="0" />
<script type="text/javascript"> vbmenu_register("postmenu_83956", true); </script>
</div>
<div class="smallfont">Junior Member</div>
</td>
<td width="100%">&nbsp;</td>
<td valign="top" nowrap="nowrap">
<div class="smallfont">
<div>Join Date: Oct 2006</div>
<div>Location: London</div>
<div>
						Posts: 19
					</div>
<div> </div>
</div>
</td>
</tr>
</table>
<!-- / user info -->
</td>
</tr>
<tr>
<td class="alt1" id="td_post_83956">
<!-- message, attachments, sig -->
<!-- icon and title -->
<div class="smallfont">
<img class="inlineimg" src="images/icons/icon5.gif" alt="Question" border="0" />
<strong>context loading?</strong>
</div>
<hr size="1" style="color:#D1D1E1; background-color:#D1D1E1" />
<!-- / icon and title -->
<!-- message -->
<div id="post_message_83956">
			
			I've got problems with Hibernate giving me a LazyInitializationException and I think it's down to two hibernate sessions opening in my requests, and I can't figure out where or why the second session is being opened. <br />
<br />
I'm running the OpenSessionInViewFilter, and I have web-flow, acegi, transactions and hibernate running behind it. <br />
<br />
The LazyInitializationException occurs in the JSP, so I suspect that the web-flow actions which obtain the Hibernate objects and put them in the requestScope are using the wrong Hibernate session.  <br />
<br />
I have all my Hibernate sessionFactory and DAOs defined in an applicationContext.xml which goes into the root context.<br />
<br />
The servlet context on the other hand contains is set up with the web-flow beans. <br />
<br />
The acegi security config though contains alot that I want to put into the servlet context but can't seperate out from the config for the business layer security, so I have it loaded in the root context. I included it below. <br />
<br />
From reading <a href="http://forum.springframework.org/showpost.php?p=76712&amp;postcount=6">this  post about the same problem</a>, it seems I might need to configure the context loading properly because the openSessionInViewFilter loads from the root context but the webflow beans may be causing the creation of a second sessionFactory. Does that sound rational to the more experienced here? <br />
<br />
Which context should this acegi config file go in, or should I try dividing it? It's below the edited web.xml. Followed by the acegi-authorisation.xml for the business layer.
		</div>
<!-- / message -->
<div style="margin-top: 10px" align="right">
<!-- controls -->
<a href="newreply.php?do=newreply&amp;p=83956" rel="nofollow"><img src="images/buttons/quote.gif" alt="Reply With Quote" border="0" /></a>
<a href="newreply.php?do=newreply&amp;p=83956" rel="nofollow" onclick="return false"><img src="images/buttons/multiquote_off.gif" alt="Multi-Quote This Message" border="0" id="mq_83956" /></a>
<a href="newreply.php?do=newreply&amp;p=83956" rel="nofollow" id="qr_83956" onclick="return false"><img src="images/buttons/quickreply.gif" alt="Quick reply to this message" border="0" /></a>
<!-- / controls -->
</div>
<!-- message, attachments, sig -->
</td>
</tr>
</table>
<!-- post 83956 popup menu -->
<div class="vbmenu_popup" id="postmenu_83956_menu" style="display:none;">
<table cellpadding="4" cellspacing="1" border="0">
<tr>
<td class="thead">ahardy66</td>
</tr>
<tr><td class="vbmenu_option"><a href="member.php?u=20416">View Public Profile</a></td></tr>
<tr><td class="vbmenu_option"><a href="private.php?do=newpm&amp;u=20416" rel="nofollow">Send a private message to ahardy66</a></td></tr>
<tr><td class="vbmenu_option"><a href="search.php?do=finduser&amp;u=20416" rel="nofollow">Find all posts by ahardy66</a></td></tr>
<tr><td class="vbmenu_option"><a href="profile.php?do=addlist&amp;userlist=buddy&amp;u=20416">Add ahardy66 to Your Contacts</a></td></tr>
</table>
</div>
<!-- / post 83956 popup menu -->
</div>
</div>
</div>
</div>
<!-- / close content container -->
<!-- / post #83956 --><!-- post #83957 -->
<!-- open content container -->
<div align="center">
<div class="page" style="width:100%; text-align:left">
<div style="padding:0px 0px 0px 0px" align="left">
<div id="edit83957" style="padding:0px 0px 6px 0px">
<!-- this is not the last post shown on the page -->
<table class="tborder" id="post83957" cellpadding="6" cellspacing="1" border="0" width="100%" align="center">
<tr>
<td class="thead">
<div class="normal" style="float:right">
			&nbsp;
			#<a href="showpost.php?p=83957&amp;postcount=2" target="new" rel="nofollow" id="postcount83957" name="2"><strong>2</strong></a> &nbsp;
			
			
			<a href="report.php?p=83957" rel="nofollow"><img class="inlineimg" src="images/buttons/report.gif" alt="Report Post" border="0" /></a> &nbsp;
			
			
		</div>
<div class="normal">
<!-- status icon and date -->
<a name="post83957"><img class="inlineimg" src="images/statusicon/post_old.gif" alt="Old" border="0" /></a>
			
				Nov 1st, 2006, 10:27 AM
			
			
			<!-- / status icon and date -->
</div>
</td>
</tr>
<tr>
<td class="alt2" style="padding:0px">
<!-- user info -->
<table cellpadding="0" cellspacing="6" border="0" width="100%">
<tr>
<td nowrap="nowrap">
<div id="postmenu_83957">
<a class="bigusername" href="member.php?u=20416">ahardy66</a>
<img class="inlineimg" src="images/statusicon/user_offline.gif" alt="ahardy66 is offline" border="0" />
<script type="text/javascript"> vbmenu_register("postmenu_83957", true); </script>
</div>
<div class="smallfont">Junior Member</div>
</td>
<td width="100%">&nbsp;</td>
<td valign="top" nowrap="nowrap">
<div class="smallfont">
<div>Join Date: Oct 2006</div>
<div>Location: London</div>
<div>
						Posts: 19
					</div>
<div> </div>
</div>
</td>
</tr>
</table>
<!-- / user info -->
</td>
</tr>
<tr>
<td class="alt1" id="td_post_83957">
<!-- message, attachments, sig -->
<!-- icon and title -->
<div class="smallfont">
<img class="inlineimg" src="images/icons/icon1.gif" alt="Default" border="0" />
</div>
<hr size="1" style="color:#D1D1E1; background-color:#D1D1E1" />
<!-- / icon and title -->
<!-- message -->
<div id="post_message_83957">
<div style="margin:20px; margin-top:5px">
<div class="smallfont" style="margin-bottom:2px">Code:</div>
<pre class="alt2" dir="ltr" style="
		margin: 0px;
		padding: 6px;
		border: 1px inset;
		width: 800px;
		height: 498px;
		text-align: left;
		overflow: auto">  &lt;context-param&gt;
    &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
    &lt;param-value&gt;
      /WEB-INF/applicationContext-acegi-security.xml,
      classpath:datasource-ic.xml,
      classpath:applicationContext-authorisation.xml,
      classpath:applicationContext.xml,
      /WEB-INF/applicationContext-call-centre-service.xml
    &lt;/param-value&gt;
  &lt;/context-param&gt;
  &lt;filter&gt;
    &lt;filter-name&gt;Acegi Filter Chain Proxy&lt;/filter-name&gt;
    &lt;filter-class&gt;org.acegisecurity.util.FilterToBeanProxy&lt;/filter-class&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;targetClass&lt;/param-name&gt;
      &lt;param-value&gt;org.acegisecurity.util.FilterChainProxy&lt;/param-value&gt;
    &lt;/init-param&gt;
  &lt;/filter&gt;
  &lt;filter&gt;
    &lt;filter-name&gt;openSessionInViewFilter&lt;/filter-name&gt;
    &lt;filter-class&gt;
      org.springframework.orm.hibernate3.support.OpenSessionInViewFilter
    &lt;/filter-class&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;sessionFactoryBeanName&lt;/param-name&gt;
      &lt;param-value&gt;sessionFactory&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;singleSession&lt;/param-name&gt;
      &lt;param-value&gt;true&lt;/param-value&gt;
    &lt;/init-param&gt;
  &lt;/filter&gt;
  &lt;filter-mapping&gt;
    &lt;filter-name&gt;openSessionInViewFilter&lt;/filter-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
  &lt;/filter-mapping&gt;
  &lt;filter-mapping&gt;
    &lt;filter-name&gt;Acegi Filter Chain Proxy&lt;/filter-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
  &lt;/filter-mapping&gt;
  &lt;!-- listener to load the root application context --&gt;
  &lt;listener&gt;
    &lt;listener-class&gt;
      org.springframework.web.context.ContextLoaderListener
    &lt;/listener-class&gt;
  &lt;/listener&gt;
  &lt;servlet&gt;
    &lt;description&gt;dispatcher servlet for the application&lt;/description&gt;
    &lt;servlet-name&gt;call-centre&lt;/servlet-name&gt;
    &lt;servlet-class&gt;
      org.springframework.web.servlet.DispatcherServlet
    &lt;/servlet-class&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
      &lt;param-value&gt;
        /WEB-INF/call-centre-servlet.xml, /WEB-INF/webflow-config.xml
      &lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
  &lt;/servlet&gt;
  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;call-centre&lt;/servlet-name&gt;
    &lt;url-pattern&gt;*.htm&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;
  &lt;servlet&gt;
    &lt;display-name&gt;DWR Servlet&lt;/display-name&gt;
    &lt;servlet-name&gt;dwr-invoker&lt;/servlet-name&gt;
    &lt;servlet-class&gt;uk.ltd.getahead.dwr.DWRServlet&lt;/servlet-class&gt;
    &lt;init-param&gt;
      &lt;param-name&gt;debug&lt;/param-name&gt;
      &lt;param-value&gt;true&lt;/param-value&gt;
    &lt;/init-param&gt;
  &lt;/servlet&gt;
  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;dwr-invoker&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/dwr/*&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;</pre>
</div>
</div>
<!-- / message -->
<div style="margin-top: 10px" align="right">
<!-- controls -->
<a href="newreply.php?do=newreply&amp;p=83957" rel="nofollow"><img src="images/buttons/quote.gif" alt="Reply With Quote" border="0" /></a>
<a href="newreply.php?do=newreply&amp;p=83957" rel="nofollow" onclick="return false"><img src="images/buttons/multiquote_off.gif" alt="Multi-Quote This Message" border="0" id="mq_83957" /></a>
<a href="newreply.php?do=newreply&amp;p=83957" rel="nofollow" id="qr_83957" onclick="return false"><img src="images/buttons/quickreply.gif" alt="Quick reply to this message" border="0" /></a>
<!-- / controls -->
</div>
<!-- message, attachments, sig -->
</td>
</tr>
</table>
<!-- post 83957 popup menu -->
<div class="vbmenu_popup" id="postmenu_83957_menu" style="display:none;">
<table cellpadding="4" cellspacing="1" border="0">
<tr>
<td class="thead">ahardy66</td>
</tr>
<tr><td class="vbmenu_option"><a href="member.php?u=20416">View Public Profile</a></td></tr>
<tr><td class="vbmenu_option"><a href="private.php?do=newpm&amp;u=20416" rel="nofollow">Send a private message to ahardy66</a></td></tr>
<tr><td class="vbmenu_option"><a href="search.php?do=finduser&amp;u=20416" rel="nofollow">Find all posts by ahardy66</a></td></tr>
<tr><td class="vbmenu_option"><a href="profile.php?do=addlist&amp;userlist=buddy&amp;u=20416">Add ahardy66 to Your Contacts</a></td></tr>
</table>
</div>
<!-- / post 83957 popup menu -->
</div>
</div>
</div>
</div>
<!-- / close content container -->
<!-- / post #83957 --><!-- post #83958 -->
<!-- open content container -->
<div align="center">
<div class="page" style="width:100%; text-align:left">
<div style="padding:0px 0px 0px 0px" align="left">
<div id="edit83958" style="padding:0px 0px 6px 0px">
<!-- this is not the last post shown on the page -->
<table class="tborder" id="post83958" cellpadding="6" cellspacing="1" border="0" width="100%" align="center">
<tr>
<td class="thead">
<div class="normal" style="float:right">
			&nbsp;
			#<a href="showpost.php?p=83958&amp;postcount=3" target="new" rel="nofollow" id="postcount83958" name="3"><strong>3</strong></a> &nbsp;
			
			
			<a href="report.php?p=83958" rel="nofollow"><img class="inlineimg" src="images/buttons/report.gif" alt="Report Post" border="0" /></a> &nbsp;
			
			
		</div>
<div class="normal">
<!-- status icon and date -->
<a name="post83958"><img class="inlineimg" src="images/statusicon/post_old.gif" alt="Old" border="0" /></a>
			
				Nov 1st, 2006, 10:28 AM
			
			
			<!-- / status icon and date -->
</div>
</td>
</tr>
<tr>
<td class="alt2" style="padding:0px">
<!-- user info -->
<table cellpadding="0" cellspacing="6" border="0" width="100%">
<tr>
<td nowrap="nowrap">
<div id="postmenu_83958">
<a class="bigusername" href="member.php?u=20416">ahardy66</a>
<img class="inlineimg" src="images/statusicon/user_offline.gif" alt="ahardy66 is offline" border="0" />
<script type="text/javascript"> vbmenu_register("postmenu_83958", true); </script>
</div>
<div class="smallfont">Junior Member</div>
</td>
<td width="100%">&nbsp;</td>
<td valign="top" nowrap="nowrap">
<div class="smallfont">
<div>Join Date: Oct 2006</div>
<div>Location: London</div>
<div>
						Posts: 19
					</div>
<div> </div>
</div>
</td>
</tr>
</table>
<!-- / user info -->
</td>
</tr>
<tr>
<td class="alt1" id="td_post_83958">
<!-- message, attachments, sig -->
<!-- icon and title -->
<div class="smallfont">
<img class="inlineimg" src="images/icons/icon1.gif" alt="Default" border="0" />
<strong>posting more relevant config</strong>
</div>
<hr size="1" style="color:#D1D1E1; background-color:#D1D1E1" />
<!-- / icon and title -->
<!-- message -->
<div id="post_message_83958">
			
			This is the applicationContext-acegi-security.xml<br />
<br />
<div style="margin:20px; margin-top:5px">
<div class="smallfont" style="margin-bottom:2px">Code:</div>
<pre class="alt2" dir="ltr" style="
		margin: 0px;
		padding: 6px;
		border: 1px inset;
		width: 800px;
		height: 498px;
		text-align: left;
		overflow: auto">  &lt;bean id=&quot;filterChainProxy&quot; class=&quot;org.acegisecurity.util.FilterChainProxy&quot;&gt;
    &lt;property name=&quot;filterInvocationDefinitionSource&quot;&gt;
      &lt;value&gt;
        CONVERT_URL_TO_LOWERCASE_BEFORE_COMPARISON PATTERN_TYPE_APACHE_ANT
        /**=loginAttemptFilter,httpSessionContextIntegrationFilter,logoutFilter,authenticationProcessingFilter,securityContextHolderAwareRequestFilter,rememberMeProcessingFilter,anonymousProcessingFilter,exceptionTranslationFilter,filterInvocationInterceptor
      &lt;/value&gt;
    &lt;/property&gt;
  &lt;/bean&gt;
  &lt;bean id=&quot;loginAttemptFilter&quot;
    class=&quot;com.nomadsoft.cortex.application.LoginAttemptCountFilter&quot; /&gt;
  &lt;bean id=&quot;httpSessionContextIntegrationFilter&quot;
    class=&quot;org.acegisecurity.context.HttpSessionContextIntegrationFilter&quot; /&gt;
  &lt;bean id=&quot;logoutFilter&quot; class=&quot;org.acegisecurity.ui.logout.LogoutFilter&quot;&gt;
    &lt;constructor-arg value=&quot;/index.jsp&quot; /&gt;&lt;!-- URL redirected to after logout --&gt;
    &lt;constructor-arg&gt;
      &lt;list&gt;
        &lt;ref bean=&quot;rememberMeServices&quot; /&gt;
        &lt;bean class=&quot;org.acegisecurity.ui.logout.SecurityContextLogoutHandler&quot; /&gt;
      &lt;/list&gt;
    &lt;/constructor-arg&gt;
  &lt;/bean&gt;
  &lt;bean id=&quot;authenticationProcessingFilter&quot;
    class=&quot;org.acegisecurity.ui.webapp.AuthenticationProcessingFilter&quot;&gt;
    &lt;property name=&quot;authenticationManager&quot; ref=&quot;authenticationManager&quot; /&gt;
    &lt;property name=&quot;authenticationFailureUrl&quot;
      value=&quot;/acegilogin.jsp?login_error=1&quot; /&gt;
    &lt;property name=&quot;defaultTargetUrl&quot; value=&quot;/&quot; /&gt;
    &lt;property name=&quot;filterProcessesUrl&quot; value=&quot;/j_acegi_security_check&quot; /&gt;
    &lt;property name=&quot;rememberMeServices&quot; ref=&quot;rememberMeServices&quot; /&gt;
  &lt;/bean&gt;
  &lt;bean id=&quot;securityContextHolderAwareRequestFilter&quot;
    class=&quot;org.acegisecurity.wrapper.SecurityContextHolderAwareRequestFilter&quot; /&gt;
  &lt;bean id=&quot;rememberMeProcessingFilter&quot;
    class=&quot;org.acegisecurity.ui.rememberme.RememberMeProcessingFilter&quot;&gt;
    &lt;property name=&quot;authenticationManager&quot; ref=&quot;authenticationManager&quot; /&gt;
    &lt;property name=&quot;rememberMeServices&quot; ref=&quot;rememberMeServices&quot; /&gt;
  &lt;/bean&gt;
  &lt;bean id=&quot;anonymousProcessingFilter&quot;
    class=&quot;org.acegisecurity.providers.anonymous.AnonymousProcessingFilter&quot;&gt;
    &lt;property name=&quot;key&quot; value=&quot;changeThis&quot; /&gt;
    &lt;property name=&quot;userAttribute&quot; value=&quot;anonymousUser,ROLE_ANONYMOUS&quot; /&gt;
  &lt;/bean&gt;
  &lt;bean id=&quot;exceptionTranslationFilter&quot;
    class=&quot;org.acegisecurity.ui.ExceptionTranslationFilter&quot;&gt;
    &lt;property name=&quot;authenticationEntryPoint&quot;&gt;
      &lt;bean
        class=&quot;org.acegisecurity.ui.webapp.AuthenticationProcessingFilterEntryPoint&quot;&gt;
        &lt;property name=&quot;loginFormUrl&quot; value=&quot;/acegilogin.jsp&quot; /&gt;
        &lt;property name=&quot;forceHttps&quot; value=&quot;false&quot; /&gt;
      &lt;/bean&gt;
    &lt;/property&gt;
    &lt;property name=&quot;accessDeniedHandler&quot;&gt;
      &lt;bean class=&quot;org.acegisecurity.ui.AccessDeniedHandlerImpl&quot;&gt;
        &lt;property name=&quot;errorPage&quot; value=&quot;/accessDenied.jsp&quot; /&gt;
      &lt;/bean&gt;
    &lt;/property&gt;
  &lt;/bean&gt;
  &lt;bean id=&quot;filterInvocationInterceptor&quot;
    class=&quot;org.acegisecurity.intercept.web.FilterSecurityInterceptor&quot;&gt;
    &lt;property name=&quot;authenticationManager&quot; ref=&quot;authenticationManager&quot; /&gt;
    &lt;property name=&quot;accessDecisionManager&quot;&gt;
      &lt;bean class=&quot;org.acegisecurity.vote.AffirmativeBased&quot;&gt;
        &lt;property name=&quot;allowIfAllAbstainDecisions&quot; value=&quot;false&quot; /&gt;
        &lt;property name=&quot;decisionVoters&quot;&gt;
          &lt;list&gt;
            &lt;bean class=&quot;org.acegisecurity.vote.RoleVoter&quot; /&gt;
            &lt;!-- bean class=&quot;org.acegisecurity.vote.AuthenticatedVoter&quot;/ --&gt;
          &lt;/list&gt;
        &lt;/property&gt;
      &lt;/bean&gt;
    &lt;/property&gt;
    &lt;property name=&quot;objectDefinitionSource&quot;&gt;
      &lt;value&gt;
        CONVERT_URL_TO_LOWERCASE_BEFORE_COMPARISON PATTERN_TYPE_APACHE_ANT
        /flow.*=ROLE_SUPER_USER_JUNIOR,ROLE_SUPER_USER_SENIOR,${authorisation.group}
        /**=ROLE_ANONYMOUS,ROLE_SUPER_USER_JUNIOR,ROLE_SUPER_USER_SENIOR,${authorisation.group}
      &lt;/value&gt;
    &lt;/property&gt;
  &lt;/bean&gt;
  &lt;bean id=&quot;rememberMeServices&quot;
    class=&quot;org.acegisecurity.ui.rememberme.TokenBasedRememberMeServices&quot;&gt;
    &lt;property name=&quot;userDetailsService&quot; ref=&quot;userDetailsFactory&quot; /&gt;
    &lt;property name=&quot;key&quot; value=&quot;changeThis&quot; /&gt;
  &lt;/bean&gt;
  &lt;bean id=&quot;authenticationManager&quot;
    class=&quot;org.acegisecurity.providers.ProviderManager&quot;&gt;
    &lt;property name=&quot;providers&quot;&gt;
      &lt;list&gt;
        &lt;ref local=&quot;daoAuthenticationProvider&quot; /&gt;
        &lt;bean
          class=&quot;org.acegisecurity.providers.anonymous.AnonymousAuthenticationProvider&quot;&gt;
          &lt;property name=&quot;key&quot; value=&quot;changeThis&quot; /&gt;
        &lt;/bean&gt;
        &lt;bean
          class=&quot;org.acegisecurity.providers.rememberme.RememberMeAuthenticationProvider&quot;&gt;
          &lt;property name=&quot;key&quot; value=&quot;changeThis&quot; /&gt;
        &lt;/bean&gt;
      &lt;/list&gt;
    &lt;/property&gt;
  &lt;/bean&gt;
  &lt;bean id=&quot;daoAuthenticationProvider&quot;
    class=&quot;org.acegisecurity.providers.dao.DaoAuthenticationProvider&quot;&gt;
    &lt;property name=&quot;userDetailsService&quot; ref=&quot;userDetailsFactory&quot; /&gt;
    &lt;property name=&quot;hideUserNotFoundExceptions&quot; value=&quot;false&quot; /&gt;
    &lt;property name=&quot;userCache&quot;&gt;
      &lt;bean
        class=&quot;org.acegisecurity.providers.dao.cache.EhCacheBasedUserCache&quot;&gt;
        &lt;property name=&quot;cache&quot;&gt;
          &lt;bean class=&quot;org.springframework.cache.ehcache.EhCacheFactoryBean&quot;&gt;
            &lt;property name=&quot;cacheManager&quot;&gt;
              &lt;bean
                class=&quot;org.springframework.cache.ehcache.EhCacheManagerFactoryBean&quot; /&gt;
            &lt;/property&gt;
            &lt;property name=&quot;cacheName&quot; value=&quot;userCache&quot; /&gt;
          &lt;/bean&gt;
        &lt;/property&gt;
      &lt;/bean&gt;
    &lt;/property&gt;
    &lt;property name=&quot;passwordEncoder&quot; ref=&quot;passwordEncoder&quot; /&gt;
  &lt;/bean&gt;
  &lt;bean id=&quot;passwordEncoder&quot;
    class=&quot;com.nomadsoft.cortex.application.CortexPasswordEncoder&quot; /&gt;
  &lt;bean id=&quot;authenticationEventListener&quot;
    class=&quot;com.nomadsoft.cortex.application.AuthenticationEventListener&quot;&gt;
    &lt;property name=&quot;dataSource&quot; ref=&quot;acegiDataSource&quot; /&gt;
    &lt;property name=&quot;maxLoginAttempts&quot; value=&quot;0&quot; /&gt;
  &lt;/bean&gt;
  &lt;bean id=&quot;userDetailsFactory&quot;
    class=&quot;com.nomadsoft.cortex.application.UserDetailsServiceImpl&quot;&gt;
    &lt;property name=&quot;dataSource&quot; ref=&quot;acegiDataSource&quot; /&gt;
    &lt;property name=&quot;usersByUsernameQuery&quot;&gt;
      &lt;value&gt;
        SELECT username, password, locked == 0 as enabled FROM nasuser WHERE
        username = ? AND username != ''
      &lt;/value&gt;
    &lt;/property&gt;
    &lt;property name=&quot;authoritiesByUsernameQuery&quot;&gt;
      &lt;value&gt;
        SELECT u.username, rolename as authority FROM nasrole r, nasgrantedrole
        g, nasusergroup u WHERE g.role_id = r.id AND g.groupname = u.groupname
        AND u.username = ? AND NOT EXISTS (SELECT * FROM nasgrantedrole WHERE
        role_id = r.id AND username = u.username)
      &lt;/value&gt;
    &lt;/property&gt;
    &lt;property name=&quot;rolePrefix&quot; value=&quot;ROLE_&quot; /&gt;
  &lt;/bean&gt;
  &lt;!-- bean id=&quot;userDetailsFactory&quot;
    class=&quot;com.nomadsoft.cortex.application.UserDetailsServiceImpl&quot;&gt;
    &lt;property name=&quot;dataSource&quot; ref=&quot;acegiDataSource&quot;/&gt;
    &lt;property name=&quot;usersByUsernameQuery&quot;&gt;
    &lt;value&gt;SELECT username, password, locked == 0 as enabled FROM nasuser WHERE username = ? and username != ''&lt;/value&gt;
    &lt;/property&gt;
    &lt;property name=&quot;authoritiesByUsernameQuery&quot;&gt;
    &lt;value&gt;SELECT username, groupname as authority FROM nasusergroup where username = ?&lt;/value&gt;
    &lt;/property&gt;
    &lt;property name=&quot;rolePrefix&quot; value=&quot;ROLE_&quot;/&gt;
    &lt;/bean --&gt;
  &lt;bean id=&quot;loggerListener&quot;
    class=&quot;org.acegisecurity.event.authentication.LoggerListener&quot; /&gt;
  &lt;bean id=&quot;propertyPlaceholderConfig&quot;
    class=&quot;org.springframework.beans.factory.config.PropertyPlaceholderConfigurer&quot;&gt;
    &lt;property name=&quot;location&quot; value=&quot;classpath:security.properties&quot; /&gt;
  &lt;/bean&gt;</pre>
</div>and this is the applicationContext-authorisation.xml<br />
<br />
<div style="margin:20px; margin-top:5px">
<div class="smallfont" style="margin-bottom:2px">Code:</div>
<pre class="alt2" dir="ltr" style="
		margin: 0px;
		padding: 6px;
		border: 1px inset;
		width: 800px;
		height: 498px;
		text-align: left;
		overflow: auto">  &lt;!-- An access decision voter that reads ROLE_* configuration settings --&gt;
  &lt;bean id=&quot;roleVoter&quot; class=&quot;org.acegisecurity.vote.RoleVoter&quot; /&gt;
  &lt;!-- An access decision manager used by the business objects --&gt;
  &lt;bean id=&quot;businessAccessDecisionManager&quot;
    class=&quot;org.acegisecurity.vote.AffirmativeBased&quot;&gt;
    &lt;property name=&quot;decisionVoters&quot;&gt;
      &lt;list&gt;
        &lt;ref local=&quot;roleVoter&quot; /&gt;
      &lt;/list&gt;
    &lt;/property&gt;
  &lt;/bean&gt;
  &lt;bean id=&quot;methodSecurityInterceptor&quot;
    class=&quot;org.acegisecurity.intercept.method.aopalliance.MethodSecurityInterceptor&quot;&gt;
    &lt;property name=&quot;authenticationManager&quot;&gt;
      &lt;ref bean=&quot;authenticationManager&quot; /&gt;
    &lt;/property&gt;
    &lt;property name=&quot;accessDecisionManager&quot;&gt;
      &lt;ref local=&quot;businessAccessDecisionManager&quot; /&gt;
    &lt;/property&gt;
    &lt;property name=&quot;objectDefinitionSource&quot;&gt;
      &lt;value&gt;
[snipped]
      &lt;/value&gt;
    &lt;/property&gt;
  &lt;/bean&gt;
  &lt;bean id=&quot;transactionInterceptor&quot;
    class=&quot;org.springframework.transaction.interceptor.TransactionInterceptor&quot;&gt;
    &lt;property name=&quot;transactionManager&quot; ref=&quot;transactionManager&quot; /&gt;
    &lt;property name=&quot;transactionAttributes&quot;&gt;
      &lt;props&gt;
        &lt;prop key=&quot;reportCardLostCore&quot;&gt;PROPAGATION_REQUIRES_NEW&lt;/prop&gt;
        &lt;prop key=&quot;reportCardStolenCore&quot;&gt;PROPAGATION_REQUIRES_NEW&lt;/prop&gt;
        &lt;prop key=&quot;get*&quot;&gt;PROPAGATION_SUPPORTS,readOnly&lt;/prop&gt;
        &lt;prop key=&quot;*&quot;&gt;PROPAGATION_REQUIRED&lt;/prop&gt;
      &lt;/props&gt;
    &lt;/property&gt;
  &lt;/bean&gt;
  &lt;bean id=&quot;autoProxyCreator&quot;
    class=&quot;org.springframework.aop.framework.autoproxy.BeanNameAutoProxyCreator&quot;&gt;
    &lt;property name=&quot;interceptorNames&quot;&gt;
      &lt;list&gt;
        &lt;value&gt;transactionInterceptor&lt;/value&gt;
        &lt;value&gt;methodSecurityInterceptor&lt;/value&gt;
      &lt;/list&gt;
    &lt;/property&gt;
    &lt;property name=&quot;beanNames&quot;&gt;
      &lt;list&gt;
        &lt;value&gt;*Service*&lt;/value&gt;
      &lt;/list&gt;
    &lt;/property&gt;
    &lt;property name=&quot;proxyTargetClass&quot; value=&quot;true&quot; /&gt;
    &lt;property name=&quot;order&quot; value=&quot;1&quot; /&gt;
  &lt;/bean&gt;
&lt;/beans&gt;</pre>
</div>
</div>
<!-- / message -->
<!-- edit note -->
<div class="smallfont">
<hr size="1" style="color:#D1D1E1; background-color:#D1D1E1" />
<em>
					
						Last edited by ahardy66; Nov 1st, 2006 at <span class="time">10:32 AM</span>.
					
					
				</em>
</div>
<!-- / edit note -->
<div style="margin-top: 10px" align="right">
<!-- controls -->
<a href="newreply.php?do=newreply&amp;p=83958" rel="nofollow"><img src="images/buttons/quote.gif" alt="Reply With Quote" border="0" /></a>
<a href="newreply.php?do=newreply&amp;p=83958" rel="nofollow" onclick="return false"><img src="images/buttons/multiquote_off.gif" alt="Multi-Quote This Message" border="0" id="mq_83958" /></a>
<a href="newreply.php?do=newreply&amp;p=83958" rel="nofollow" id="qr_83958" onclick="return false"><img src="images/buttons/quickreply.gif" alt="Quick reply to this message" border="0" /></a>
<!-- / controls -->
</div>
<!-- message, attachments, sig -->
</td>
</tr>
</table>
<!-- post 83958 popup menu -->
<div class="vbmenu_popup" id="postmenu_83958_menu" style="display:none;">
<table cellpadding="4" cellspacing="1" border="0">
<tr>
<td class="thead">ahardy66</td>
</tr>
<tr><td class="vbmenu_option"><a href="member.php?u=20416">View Public Profile</a></td></tr>
<tr><td class="vbmenu_option"><a href="private.php?do=newpm&amp;u=20416" rel="nofollow">Send a private message to ahardy66</a></td></tr>
<tr><td class="vbmenu_option"><a href="search.php?do=finduser&amp;u=20416" rel="nofollow">Find all posts by ahardy66</a></td></tr>
<tr><td class="vbmenu_option"><a href="profile.php?do=addlist&amp;userlist=buddy&amp;u=20416">Add ahardy66 to Your Contacts</a></td></tr>
</table>
</div>
<!-- / post 83958 popup menu -->
</div>
</div>
</div>
</div>
<!-- / close content container -->
<!-- / post #83958 --><!-- post #83970 -->
<!-- open content container -->
<div align="center">
<div class="page" style="width:100%; text-align:left">
<div style="padding:0px 0px 0px 0px" align="left">
<div id="edit83970" style="padding:0px 0px 6px 0px">
<!-- this is not the last post shown on the page -->
<table class="tborder" id="post83970" cellpadding="6" cellspacing="1" border="0" width="100%" align="center">
<tr>
<td class="thead">
<div class="normal" style="float:right">
			&nbsp;
			#<a href="showpost.php?p=83970&amp;postcount=4" target="new" rel="nofollow" id="postcount83970" name="4"><strong>4</strong></a> &nbsp;
			
			
			<a href="report.php?p=83970" rel="nofollow"><img class="inlineimg" src="images/buttons/report.gif" alt="Report Post" border="0" /></a> &nbsp;
			
			
		</div>
<div class="normal">
<!-- status icon and date -->
<a name="post83970"><img class="inlineimg" src="images/statusicon/post_old.gif" alt="Old" border="0" /></a>
			
				Nov 1st, 2006, 11:21 AM
			
			
			<!-- / status icon and date -->
</div>
</td>
</tr>
<tr>
<td class="alt2" style="padding:0px">
<!-- user info -->
<table cellpadding="0" cellspacing="6" border="0" width="100%">
<tr>
<td nowrap="nowrap">
<div id="postmenu_83970">
<a class="bigusername" href="member.php?u=10907">Dave Syer</a>
<img class="inlineimg" src="images/statusicon/user_offline.gif" alt="Dave Syer is offline" border="0" />
<script type="text/javascript"> vbmenu_register("postmenu_83970", true); </script>
</div>
<div class="smallfont">Senior Member</div>
</td>
<td width="100%">&nbsp;</td>
<td valign="top" nowrap="nowrap">
<div class="smallfont">
<div>Join Date: Jun 2005</div>
<div>
						Posts: 2,950
					</div>
<div> </div>
</div>
</td>
</tr>
</table>
<!-- / user info -->
</td>
</tr>
<tr>
<td class="alt1" id="td_post_83970">
<!-- message, attachments, sig -->
<!-- icon and title -->
<div class="smallfont">
<img class="inlineimg" src="images/icons/icon1.gif" alt="Default" border="0" />
</div>
<hr size="1" style="color:#D1D1E1; background-color:#D1D1E1" />
<!-- / icon and title -->
<!-- message -->
<div id="post_message_83970">
			
			Is the lazy initialisation error related to user credentials?  Acegi will store authenticated user credentials across requests, so you will automatically have an unattached object floating around in your second or subsequent request in each session.  It doesn't mean that anything is wrong, per se, but you might need to re-asttach (i.e. lock) the user credentials before you use them or try to connect to them in a bean from the current session.
		</div>
<!-- / message -->
<div style="margin-top: 10px" align="right">
<!-- controls -->
<a href="newreply.php?do=newreply&amp;p=83970" rel="nofollow"><img src="images/buttons/quote.gif" alt="Reply With Quote" border="0" /></a>
<a href="newreply.php?do=newreply&amp;p=83970" rel="nofollow" onclick="return false"><img src="images/buttons/multiquote_off.gif" alt="Multi-Quote This Message" border="0" id="mq_83970" /></a>
<a href="newreply.php?do=newreply&amp;p=83970" rel="nofollow" id="qr_83970" onclick="return false"><img src="images/buttons/quickreply.gif" alt="Quick reply to this message" border="0" /></a>
<!-- / controls -->
</div>
<!-- message, attachments, sig -->
</td>
</tr>
</table>
<!-- post 83970 popup menu -->
<div class="vbmenu_popup" id="postmenu_83970_menu" style="display:none;">
<table cellpadding="4" cellspacing="1" border="0">
<tr>
<td class="thead">Dave Syer</td>
</tr>
<tr><td class="vbmenu_option"><a href="member.php?u=10907">View Public Profile</a></td></tr>
<tr><td class="vbmenu_option"><a href="private.php?do=newpm&amp;u=10907" rel="nofollow">Send a private message to Dave Syer</a></td></tr>
<tr><td class="vbmenu_option"><a href="search.php?do=finduser&amp;u=10907" rel="nofollow">Find all posts by Dave Syer</a></td></tr>
<tr><td class="vbmenu_option"><a href="profile.php?do=addlist&amp;userlist=buddy&amp;u=10907">Add Dave Syer to Your Contacts</a></td></tr>
</table>
</div>
<!-- / post 83970 popup menu -->
</div>
</div>
</div>
</div>
<!-- / close content container -->
<!-- / post #83970 --><!-- post #83993 -->
<!-- open content container -->
<div align="center">
<div class="page" style="width:100%; text-align:left">
<div style="padding:0px 0px 0px 0px" align="left">
<div id="edit83993" style="padding:0px 0px 6px 0px">
<!-- this is not the last post shown on the page -->
<table class="tborder" id="post83993" cellpadding="6" cellspacing="1" border="0" width="100%" align="center">
<tr>
<td class="thead">
<div class="normal" style="float:right">
			&nbsp;
			#<a href="showpost.php?p=83993&amp;postcount=5" target="new" rel="nofollow" id="postcount83993" name="5"><strong>5</strong></a> &nbsp;
			
			
			<a href="report.php?p=83993" rel="nofollow"><img class="inlineimg" src="images/buttons/report.gif" alt="Report Post" border="0" /></a> &nbsp;
			
			
		</div>
<div class="normal">
<!-- status icon and date -->
<a name="post83993"><img class="inlineimg" src="images/statusicon/post_old.gif" alt="Old" border="0" /></a>
			
				Nov 1st, 2006, 01:23 PM
			
			
			<!-- / status icon and date -->
</div>
</td>
</tr>
<tr>
<td class="alt2" style="padding:0px">
<!-- user info -->
<table cellpadding="0" cellspacing="6" border="0" width="100%">
<tr>
<td nowrap="nowrap">
<div id="postmenu_83993">
<a class="bigusername" href="member.php?u=20416">ahardy66</a>
<img class="inlineimg" src="images/statusicon/user_offline.gif" alt="ahardy66 is offline" border="0" />
<script type="text/javascript"> vbmenu_register("postmenu_83993", true); </script>
</div>
<div class="smallfont">Junior Member</div>
</td>
<td width="100%">&nbsp;</td>
<td valign="top" nowrap="nowrap">
<div class="smallfont">
<div>Join Date: Oct 2006</div>
<div>Location: London</div>
<div>
						Posts: 19
					</div>
<div> </div>
</div>
</td>
</tr>
</table>
<!-- / user info -->
</td>
</tr>
<tr>
<td class="alt1" id="td_post_83993">
<!-- message, attachments, sig -->
<!-- icon and title -->
<div class="smallfont">
<img class="inlineimg" src="images/icons/icon1.gif" alt="Default" border="0" />
</div>
<hr size="1" style="color:#D1D1E1; background-color:#D1D1E1" />
<!-- / icon and title -->
<!-- message -->
<div id="post_message_83993">
			
			No, it's just a plain ol' hibernate object from the business domain.<br />
<br />
The user bean is fine, in fact this is all part of an upgrade of spring-2.0RC3 to final, and of spring-webflow, hibernate 3.2, ehcache, acegi-security and a couple of others. <br />
<br />
As part of the upgrade, I had to change the configuration as the new software fell over on bad configurations that had worked earlier. <img src="images/smilies/frown.gif" border="0" alt="" title="Sad" class="inlineimg" />  Mainly to do with proxying for transactions and security.
		</div>
<!-- / message -->
<div style="margin-top: 10px" align="right">
<!-- controls -->
<a href="newreply.php?do=newreply&amp;p=83993" rel="nofollow"><img src="images/buttons/quote.gif" alt="Reply With Quote" border="0" /></a>
<a href="newreply.php?do=newreply&amp;p=83993" rel="nofollow" onclick="return false"><img src="images/buttons/multiquote_off.gif" alt="Multi-Quote This Message" border="0" id="mq_83993" /></a>
<a href="newreply.php?do=newreply&amp;p=83993" rel="nofollow" id="qr_83993" onclick="return false"><img src="images/buttons/quickreply.gif" alt="Quick reply to this message" border="0" /></a>
<!-- / controls -->
</div>
<!-- message, attachments, sig -->
</td>
</tr>
</table>
<!-- post 83993 popup menu -->
<div class="vbmenu_popup" id="postmenu_83993_menu" style="display:none;">
<table cellpadding="4" cellspacing="1" border="0">
<tr>
<td class="thead">ahardy66</td>
</tr>
<tr><td class="vbmenu_option"><a href="member.php?u=20416">View Public Profile</a></td></tr>
<tr><td class="vbmenu_option"><a href="private.php?do=newpm&amp;u=20416" rel="nofollow">Send a private message to ahardy66</a></td></tr>
<tr><td class="vbmenu_option"><a href="search.php?do=finduser&amp;u=20416" rel="nofollow">Find all posts by ahardy66</a></td></tr>
<tr><td class="vbmenu_option"><a href="profile.php?do=addlist&amp;userlist=buddy&amp;u=20416">Add ahardy66 to Your Contacts</a></td></tr>
</table>
</div>
<!-- / post 83993 popup menu -->
</div>
</div>
</div>
</div>
<!-- / close content container -->
<!-- / post #83993 --><!-- post #84134 -->
<!-- open content container -->
<div align="center">
<div class="page" style="width:100%; text-align:left">
<div style="padding:0px 0px 0px 0px" align="left">
<div id="edit84134" style="padding:0px 0px 6px 0px">
<table class="tborder" id="post84134" cellpadding="6" cellspacing="1" border="0" width="100%" align="center">
<tr>
<td class="thead">
<div class="normal" style="float:right">
			&nbsp;
			#<a href="showpost.php?p=84134&amp;postcount=6" target="new" rel="nofollow" id="postcount84134" name="6"><strong>6</strong></a> &nbsp;
			
			
			<a href="report.php?p=84134" rel="nofollow"><img class="inlineimg" src="images/buttons/report.gif" alt="Report Post" border="0" /></a> &nbsp;
			
			
		</div>
<div class="normal">
<!-- status icon and date -->
<a name="post84134"><img class="inlineimg" src="images/statusicon/post_old.gif" alt="Old" border="0" /></a>
			
				Nov 2nd, 2006, 06:15 AM
			
			
			<!-- / status icon and date -->
</div>
</td>
</tr>
<tr>
<td class="alt2" style="padding:0px">
<!-- user info -->
<table cellpadding="0" cellspacing="6" border="0" width="100%">
<tr>
<td nowrap="nowrap">
<div id="postmenu_84134">
<a class="bigusername" href="member.php?u=20416">ahardy66</a>
<img class="inlineimg" src="images/statusicon/user_offline.gif" alt="ahardy66 is offline" border="0" />
<script type="text/javascript"> vbmenu_register("postmenu_84134", true); </script>
</div>
<div class="smallfont">Junior Member</div>
</td>
<td width="100%">&nbsp;</td>
<td valign="top" nowrap="nowrap">
<div class="smallfont">
<div>Join Date: Oct 2006</div>
<div>Location: London</div>
<div>
						Posts: 19
					</div>
<div> </div>
</div>
</td>
</tr>
</table>
<!-- / user info -->
</td>
</tr>
<tr>
<td class="alt1" id="td_post_84134">
<!-- message, attachments, sig -->
<!-- icon and title -->
<div class="smallfont">
<img class="inlineimg" src="images/icons/icon1.gif" alt="Default" border="0" />
</div>
<hr size="1" style="color:#D1D1E1; background-color:#D1D1E1" />
<!-- / icon and title -->
<!-- message -->
<div id="post_message_84134">
			
			When I get a chance again, I will remove Acegi from the equation and try the upgraded app without it. I have upgraded the app on a different SCM workspace, so I can continue coding, but it's getting pretty old now and I need to check the stuff in before the job of merging changes becomes a days work itself. <br />
<br />
Obviously any comments would be appreciated.
		</div>
<!-- / message -->
<div style="margin-top: 10px" align="right">
<!-- controls -->
<a href="newreply.php?do=newreply&amp;p=84134" rel="nofollow"><img src="images/buttons/quote.gif" alt="Reply With Quote" border="0" /></a>
<a href="newreply.php?do=newreply&amp;p=84134" rel="nofollow" onclick="return false"><img src="images/buttons/multiquote_off.gif" alt="Multi-Quote This Message" border="0" id="mq_84134" /></a>
<a href="newreply.php?do=newreply&amp;p=84134" rel="nofollow" id="qr_84134" onclick="return false"><img src="images/buttons/quickreply.gif" alt="Quick reply to this message" border="0" /></a>
<!-- / controls -->
</div>
<!-- message, attachments, sig -->
</td>
</tr>
</table>
<!-- post 84134 popup menu -->
<div class="vbmenu_popup" id="postmenu_84134_menu" style="display:none;">
<table cellpadding="4" cellspacing="1" border="0">
<tr>
<td class="thead">ahardy66</td>
</tr>
<tr><td class="vbmenu_option"><a href="member.php?u=20416">View Public Profile</a></td></tr>
<tr><td class="vbmenu_option"><a href="private.php?do=newpm&amp;u=20416" rel="nofollow">Send a private message to ahardy66</a></td></tr>
<tr><td class="vbmenu_option"><a href="search.php?do=finduser&amp;u=20416" rel="nofollow">Find all posts by ahardy66</a></td></tr>
<tr><td class="vbmenu_option"><a href="profile.php?do=addlist&amp;userlist=buddy&amp;u=20416">Add ahardy66 to Your Contacts</a></td></tr>
</table>
</div>
<!-- / post 84134 popup menu -->
</div>
</div>
</div>
</div>
<!-- / close content container -->
<!-- / post #84134 --><div id="lastpost"></div></div></body></html>